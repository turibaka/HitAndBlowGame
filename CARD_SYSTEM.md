# カードシステム仕様書

## 概要
Hit & Blow ゲームに追加されたカードバトルモードの詳細仕様

## カードの種類

### 🎴 バフ系カード（ラウンド開始時に選択）
各ラウンド開始時に、両プレイヤーが交互にカードを1枚選択します。

#### 攻撃系
- **攻撃小**: 次の攻撃に+5ダメージ
- **攻撃中**: 次の攻撃に+10ダメージ  
- **攻撃大**: 次の攻撃ダメージが2倍

#### 防御系
- **防御小**: 次の自傷ダメージを-5軽減
- **防御中**: 次の自傷ダメージを半減
- **防御大**: 次の自傷ダメージを完全無効化

#### 回復系
- **回復小**: HP +10回復
- **回復中**: HP +20回復
- **回復大**: HP +30回復

### 🃏 補助系カード（ゲーム中に使用可能）
正解時のボーナスとして獲得し、手札として保持します。

- **反撃**: 相手の次の攻撃を跳ね返す
- **無敵**: 次のダメージを完全無効化
- **Hitボーナス**: 次のHit時、Hit数×5の追加ダメージ
- **Blowボーナス**: 次のBlow時、Blow数×3の追加ダメージ
- **HP吸収**: 相手のHPを10奪う（即時発動）

## ゲームフロー

### 1. ラウンド開始
```
ラウンド開始
  ↓
P1: カード選択（バフ系3枚から1枚）
  ↓
P2: カード選択（バフ系3枚から1枚）※別のカードセット
  ↓
P1: 数字セット
  ↓
P2: 数字セット
  ↓
バトル開始
```

### 2. バトル中
- 各プレイヤーが交互に推測
- 6回の推測（P1×3回 + P2×3回）で1ラウンド終了
- 次ラウンド開始時に再度カード選択

### 3. 正解時
```
正解！
  ↓
ボーナスカード獲得（補助系3枚から1枚）
  ↓
新ラウンド開始（カード選択へ）
```

## 対面プレイの配慮

### カード選択の秘匿性
1. **ラウンド開始時**: 
   - P1がカード選択 → 画面を隠してP2に交代
   - P2がカード選択 → 再度P1に交代
   - 各プレイヤーは異なるカードセットから選択

2. **推奨プレイ方法**:
   - カード選択時は相手に画面を見せない
   - 「カード選択完了」の合図で交代
   - 選択したカードの効果は次のアクション時に判明

## ダメージ計算

### 自傷ダメージ（0 Hit, 0 Blow時）
```kotlin
基本ダメージ = 自分の数字の各桁の合計
最終ダメージ = (基本ダメージ - 防御軽減) × 防御倍率
```
例: 数字が"123"で防御中カード使用時
- 基本: 1+2+3 = 6
- 最終: 6 × 0.5 = 3ダメージ

### 攻撃ダメージ（正解時）
```kotlin
基本ダメージ = 推測した数字の各桁の合計
最終ダメージ = (基本ダメージ + 攻撃ボーナス) × 攻撃倍率 + Hit/Blowボーナス
```
例: "456"で正解、攻撃大カード使用時
- 基本: 4+5+6 = 15
- 最終: 15 × 2 = 30ダメージ

### 特殊効果
- **反撃**: 攻撃ダメージが攻撃側に跳ね返る
- **無敵**: あらゆるダメージを無効化（1回のみ）
- **HP吸収**: 相手のHPを減らし、同じ量を自分が回復

## UI表示

### 進行状況バー
- **ラウンド**: 現在のラウンド番号（青色）
- **ターン**: 現在のターン番号（緑色）
- **総ターン**: ゲーム開始からの総ターン数（グレー）

### ダメージ情報
赤背景で最新のダメージ情報を表示：
- "P1が自傷ダメージ -12"
- "P2がP1に攻撃ダメージ -30 (×2) (+10)"
- "P1の反撃！P2に25ダメージ"

## 実装ポイント

### カード配布タイミング
- **ラウンド開始時**: バフ系カードを配布
- **正解時**: 補助系カードを配布（手札に追加）
- **6ターン終了時**: 新ラウンド開始（カード選択へ戻る）

### カード効果の適用
- **バフ系**: 選択直後に効果適用、次の該当アクション後にリセット
- **補助系**: プレイヤーが任意のタイミングで使用可能（今後実装予定）

## 今後の拡張予定
- [ ] 手札からの補助カード使用UI
- [ ] カード効果の視覚的表示（アイコン・エフェクト）
- [ ] カードの詳細説明画面
- [ ] カードの使用履歴表示
- [ ] 新カード追加（スキップ、交換など）
